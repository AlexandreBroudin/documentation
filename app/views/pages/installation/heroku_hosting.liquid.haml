{% extends 'index' %}

{% block 'main-content' %}
%section#page-title
  .inner-container
    %header
      Host on Heroku
    %p The installation on Heroku is pretty simple and it only requires a Heroku (free) / Amazon S3 (inexpensive) account.
%section#content#grid-three
  #main
    :markdown
      <div class="alert">
      We assume that you installed <strong>Heroku</strong> on your machine. Follow this [link][] if you have not.
      </div>
      <div class="alert">
      We also assume that you followed the <strong>[instructions][]</strong> to install the engine.
      </div>
      
      # 1. Add the Heroku extension

      Open your **Gemfile** file in your LocomotiveCMS application and add the following statement right after the one about the LocomotiveCMS engine.

          gem 'locomotive-heroku', '~> 0.0.2', :require => 'locomotive/heroku'
          gem 'thin', :group => 'production'

      While you’re at it, add the following line right before your first gem entry

          ruby '1.9.3'

      Then, in your terminal, run

          gem install bundler --pre
          bundle install

      # 2. Create the Heroku app from your app folder

          git init .
          heroku create <YOUR APP NAME>
          heroku config:add BUNDLE_WITHOUT=development:test

      # 3. Set up a remote Mongodb database

      You can find more information [here.][]

          heroku addons:add mongohq:free

      Modify the configuration for the production mongodb database in the **config/mongoid.yml** file.

          production:
            uri: <%= ENV['MONGOHQ_URL'] %>

      # 4. Enable emails

      LocomotiveCMS needs to send emails and Heroku provides a nice way to send emails for free without configuring a  whole mail server on your own. You can find more information [here.][1]

          heroku addons:add sendgrid:starter

      Add the following lines in your **config/environments/production.rb** file.

          config.action_mailer.delivery_method = :smtp
          config.action_mailer.smtp_settings = {
            :address        => 'smtp.sendgrid.net',
            :port           => 25,
            :authentication => :plain,
            :user_name      => ENV['SENDGRID_USERNAME'],
            :password       => ENV['SENDGRID_PASSWORD'],
            :domain         => ENV['SENDGRID_DOMAIN']
          }

      # 5. Configure Heroku to work with your Amazon S3 credentials

      Unless you modified your **config/initializers/carrierwave.rb** file, Carrierwave should be set up for Amazon S3 in the production environment.

          heroku config:add S3_KEY_ID=<YOUR S3 KEY ID>
          heroku config:add S3_SECRET_KEY=<YOUR S3 SECRET KEY>
          heroku config:add S3_BUCKET=<YOUR S3 BUCKET NAME>
          heroku config:add S3_BUCKET_REGION=<YOUR S3 BUCKET REGION>

      <div class="alert alert-info">
      <strong>Note:</strong> For S3 Bucket Region var, here is the [correspondance table][] between your ‘human’ bucket region name, and it’s endpoint :
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Region</th>
            <th>Location Constraint</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>US Standard *</td>
            <td>--</td>
          </tr>
          <tr>
            <td>US West (Oregon) Region</td>
            <td>us-west-2</td>
          </tr>
          <tr>
            <td>US West (Northern California) Region</td>
            <td>us-west-1</td>
          </tr>
          <tr>
            <td>EU (Ireland) Region</td>
            <td>eu-west-1</td>
          </tr>
          <tr>
            <td>Asia Pacific (Singapore) Region</td>
            <td>ap-southeast-1</td>
          </tr>
          <tr>
            <td>Asia Pacific (Tokyo) Region</td>
            <td>ap-northeast-1</td>
          </tr>
          <tr>
            <td>South America (Sao Paulo) Region</td>
            <td>sa-east-1</td>
          </tr>
        </tbody>
      </table>

      # 6. Edit your Locomotive config file.

      Open your **config/initializers/locomotive.rb** file and add the
      following lines :

          config.hosting = {
            :target     => :heroku,
            :api_key    => ENV['HEROKU_API_KEY'],
            :app_name   => ENV['HEROKU_APP_NAME']
          }

      <div class="alert alert-info">
      <strong>Note:</strong> the following configuration is in the case you host a single
      website. If you want to use LocomotiveCMS as a multi-sites platform, you have to uncomment the lines relative to the multi-sites option and set your main domain name (ex: mycmsplatform.com).
      </div>

      # 7. Configure Heroku credentials

      Specify your credentials :

          heroku config:add HEROKU_API_KEY=<YOUR HEROKU API KEY>
          heroku config:add HEROKU_APP_NAME=<YOUR APP NAME>

      <div class="alert alert-info">
      <strong>Note:</strong>
      [link]: http://devcenter.heroku.com/articles/quickstart
      [instructions]: getting_started
      [here.]: http://docs.heroku.com/mongohq
      [1]: http://docs.heroku.com/sendgrid
      [correspondance table]: http://docs.amazonwebservices.com/general/latest/gr/rande.html
      </div>
  {% include 'installation_summary' %}

{% endblock %}